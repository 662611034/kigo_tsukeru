# ダウンロード
最新版は[こちら](https://drive.google.com/file/d/1VJp48N6k1W63HtVY4Dgde4jVFb_y72NG/view?usp=sharing)のリンクからダウンロードできます。容量が大きくてgithubにアップロードできませんでした。   
過去バージョンはアップデート履歴からダウンロードできます。

# このプログラムについて
.psdファイルのレイヤーの名前の先頭に「!」や「\*」を一括でつけるプログラムです。.anmファイルへの書き出しもできます。

## .exeの動作環境
64bitのWindows10での動作を確認できました。ビルドに用いたツールの仕様上32bit Windowsでは動作しません。   

## アップデート履歴
- [2020.08.06](https://drive.google.com/file/d/1jxZIbeXXMJca6zSsArGFlmtMsuSjPM71/view?usp=sharing)
  - 初版をアップロードしました
- [2020.08.07](https://drive.google.com/file/d/1TT511MpYgO7yTWXClm4BHvN2bvpA3hUr/view?usp=sharing)
  - 「戻す」「やり直す」機能を実装しました
  - 正規表現パッケージを使わないようにしました
  - GUIにボタンを追加したり、ウィジェットの大きさを変えるなどの変更を加えました
- [2020.08.08](https://drive.google.com/file/d/1QOtrYraZOFFy9SuCn0YoWNfRjK2iNef1/view?usp=sharing)
  - 固定条件の変換メニューを廃止しました
  - 削除対象も条件を指定できるようにしました
  - 以上に伴いGUIに変更を加えました
  - 変換時スクロール位置がリセットされないようにしました(昼上げなおしver.)
- [2020.08.15](https://drive.google.com/file/d/1VJp48N6k1W63HtVY4Dgde4jVFb_y72NG/view?usp=sharing)
  - 一部のボタンを上段メニューバーに変更しました
  - ファイルを開くときと保存するとき文字コードを指定できるようにしました
  - 変換対象レイヤーをチェックボックスで選択できるようにしました
  - 変換項目を「!」をつける、「\*」をつける、それらを消すの3つに変更しました
  - .anmファイルの書き出し機能を追加しました
  - 以上に伴いGUIに変更を加えました
  - psdファイルを扱うためのクラスが大幅に変更されました
  
# 使い方
ダウンロードした.exeファイルを実行し、上段の「ファイル」メニューから編集したい.psdファイルを開くと以下のような画面になります。   
ちなみに起動には少々時間がかかります。

![キャプチャ](https://user-images.githubusercontent.com/48207892/90304446-eabe1880-def2-11ea-8c8d-9b69ad26ec5a.PNG)

名前を変更したいレイヤーのチェックボックスにチェックを入れ、「!」をつける、「\*」をつける、「!」と「\*」を消すボタンを押すとその通りに名前が変換されます。   
以下ではプログラムの各動作におけるより詳細な説明が続きます。

## ファイルを開く・保存する
- 画面上段左側のプルダウンメニューでファイルを開くとき使う文字コードを選ぶことができます。
- ファイルを上書き保存するときは開いたときの(もし別名保存していればその時用いた)文字コードで保存されます
- 別名で保存する場合は選択されている文字コードで保存されます

## レイヤー名の変換
- チェックを入れたレイヤーの名前が変換されます
- レイヤー名にすでに「!」か「\*」の**どちらかが**ついている場合、追加で「!」や「\*」をつけることはありません
- ただし全角記号は「!」や「\*」としてみなしません
- 「!」と「\*」を外す場合、「!」や「\*」が複数つけられていたらそれらを全て消します
- 変換メニュー選択条件のタブを切り替えることによって旧版で使っていた条件指定の変換を行うことができます
- 変換をボタンで実行する場合でもショートカットキーで実行する場合でも対象レイヤーは今選ばれているタブに従います

### 条件を指定して変換
- レイヤーの層、名前と一致条件、レイヤーの種類を指定して変換を行います
- レイヤーの層は右側のレイヤー表示領域で確認することができます
- 「0層」は特定の層ではなく全ての層を指定する特殊例です
- レイヤー名の一致条件の「含む」や「一致する」は融通が利かず、一言一句違わず同じ文字列だけを検索します
  - 文字と小文字、ひらがなとカタカナ、全角と半角は別の文字として認識します
  - 空白文字も一致していなければなりません
    - 例）「ああ　ついでに」は「あつい」を含んでいるとはみなしません
- 変換対象のプルダウンメニューの「物」はレイヤーとグループ両方に対して変換を行うことを意味します

## .anmファイルの書き出し
- レイヤー表示領域に表示されている「追加」ボタンをクリックすることで.anmファイルに書き出すグループを選択することができます
- .anmファイルはshift-jisで作成されます
- 書き出し対象レイヤーの「1つ外す」は最後に追加されたレイヤーから順に適用されます
- 既に選択されているレイヤーの順番を変えることはできないため、一旦対象から外した後追加しなおさなければなりません
- 「既定の名前で書き出す」と元の.psdファイルと同じフォルダに「同じ名前+末尾文字列.anm」のファイルに出力されます
- 「既定の名前で書き出す」は同名ファイルが既に存在していても確認を行うことなく上書きします

## レイヤー表示領域

### レイヤー表示の折り畳み
  - チェックボックスの左側の、枝別れを表示している空間をクリックすることでグループの表示を折りたたんだり展開することができます

### チェックボックス
- グループのレイヤーのチェックボックスはShift+クリック、あるいはctrl+shift+クリックで下位のレイヤーを一括で選択することができます
  - shift+クリックでは直下のレイヤーが一括で選択されます
  - ctrl+shift+クリックでは下位のレイヤー全てが選択されます
- 下位レイヤーの一括選択はクリックしたレイヤーの選択状況と逆の状態として選択されます
  - 例）チェックが入っているグループをshift+クリックしてチェックを外すと、直下のレイヤーはチェックが入った状態に変更されます
  - このとき、既にチェックが入っていた直下のレイヤーは状態が反転することなくチェックが入ったままになります
- 最上段のチェックボックス(「層」と「レイヤー構造」の間)は1層のレイヤーを一括で選択するためだけのものであり、変換動作とは関係ありません
  - ここにチェックが入っていても全てのレイヤー名が変換されるようなことはありません

## 「戻す」と「やり直し」
- それぞれ128回までの記録ができます

## ショートカットキー
- ctrl+o：ファイルを開く
- ctrl+s / ctrl+shift+s：上書き保存 / 別名で保存
- F5 / F6 / F7：「!」をつける / 「\*」をつける / 「!」と「\*」を消す
- ctrl+z / ctrl+yあるいはctrl+shift+z：戻す / やりなおす
- ctrl+1 / ctrl+2：「変換対象選択条件」の切り替え(チェックしたレイヤー / 条件指定)
- ctrl+e / ctrl+shift+e：.anmファイルを既定の名前で書き出す / 名前を指定して書き出す
- ctrl+a / ctrl+shift+a：全てのレイヤーにチェックを入れる / 外す
- ctrl+q：プログラムのを終了する

## 既知の問題
- 容量がかなり大きいです
- ウィンドウの大きさを変えてもレイヤー表示領域の大きさは変わりません

# フィードバックについて
ツイッター( https://twitter.com/662611034 )の方でも受け付けます。

# プログラムの中身について

## 構成
以下の3つのファイルで構成されています。
- psd_subtool.py：psdを読み込んだりレイヤー名を変えたりするクラスを定義しています。Python標準ライブラリのreと、pipからインストールしたpsd_toolsを用いています。
- gui.py：GUIの見た目の部分と、選択した項目の情報を出力するクラスを定義しています。Python標準ライブラリのtkinterを用いました。
- \_\_main\_\_.py：上記のhandler.pyとgui.pyをまとめて新しいメソッドを定義したりボタンに関数をバインドしたりしています。ウェブページを開くためにPython標準ライブラリのwebbrowserを用いています。
Windows以外の環境の方はこれらのファイルと必要なパッケージをダウンロードしてご利用いただくこともできます。Windows以外の環境でこのプログラムが必要な場合があるかは甚だ疑問ですが。

## ビルド
pyinstallerを用いて64bit Windows 10でビルドしました。
